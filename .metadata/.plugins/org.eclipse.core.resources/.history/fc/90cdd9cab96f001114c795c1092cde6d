package YambaClient.Package;

import winterwell.jtwitter.Twitter;
import android.app.Application;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
import android.preference.PreferenceManager;

public class YambaClientApplication extends Application implements OnSharedPreferenceChangeListener
{
	private volatile Twitter twitter;
	private SharedPreferences prefs;

	public void onSharedPreferenceChanged(SharedPreferences arg0, String arg1) 
	{
		twitter = null;
		
		boolean timelinePullServicechecked = prefs.getBoolean("activateTimelinePullService", false);
		
		if (timelinePullServicechecked)
		{
			Intent msg = new Intent(this, TimerIntentService.class);
	    	msg.putExtra(UpdateStatusService.MessageKey, TimerIntentService.StartMessage);
	    	startService(msg);
			//startService(new Intent(this, TimelinePullService.class));
		}
		else
		{
			
			//stopService(new Intent(this, TimelinePullService.class));
		}
	}

	@Override
	public void onCreate() 
	{
		super.onCreate();
		prefs = PreferenceManager.getDefaultSharedPreferences(this);
		prefs.registerOnSharedPreferenceChangeListener(this);
		twitter = null;
	}
	
	public synchronized Twitter GetTwitter()
	{
		if(twitter == null)
		{
			twitter = new Twitter(prefs.getString("username", ""), prefs.getString("password", ""));
	        twitter.setAPIRootUrl(prefs.getString("site_url", ""));
		}
		
		return twitter;
	}
}